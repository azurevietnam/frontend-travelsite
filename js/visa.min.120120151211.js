var RATE_TABLE=[{id:"1",country:["2","5","6","7","10","11","16","17","19","21","24","25","27","29","31","33","37","39","41","45","47","48","55","59","60","65","67","78","83","84","85","86","87","93","95","96","97","98","102","106","108","120","121","123","124","127","128","131","134","139","140","145","148","151","163","166","168","169","170","172","173","174"],price:{"1":[{p:"12",up:"10",q:"1",d:"5"},{p:"12",up:"10",q:"2",d:"5"},{p:"12",up:"10",q:"3",d:"5"},{p:"12",up:"10",q:"4",d:"5"},{p:"12",up:"10",q:"5",d:"5"},{p:"12",up:"10",q:"6",d:"5"},{p:"12",up:"10",q:"7",d:"5"},{p:"12",up:"10",q:"8",d:"5"},{p:"12",up:"10",q:"9",d:"5"},{p:"12",up:"10",q:"10",d:"5"}],"2":[{p:"25",up:"10",q:"1",d:"5"},{p:"25",up:"10",q:"2",d:"5"},{p:"25",up:"10",q:"3",d:"5"},{p:"25",up:"10",q:"4",d:"5"},{p:"25",up:"10",q:"5",d:"5"},{p:"25",up:"10",q:"6",d:"5"},{p:"25",up:"10",q:"7",d:"5"},{p:"25",up:"10",q:"8",d:"5"},{p:"25",up:"10",q:"9",d:"5"},{p:"25",up:"10",q:"10",d:"5"}],"3":[{p:"20",up:"10",q:"1",d:"5"},{p:"20",up:"10",q:"2",d:"5"},{p:"20",up:"10",q:"3",d:"5"},{p:"18",up:"10",q:"4",d:"5"},{p:"18",up:"10",q:"5",d:"5"},{p:"16",up:"10",q:"6",d:"5"},{p:"16",up:"10",q:"7",d:"5"},{p:"16",up:"10",q:"8",d:"5"},{p:"16",up:"10",q:"9",d:"5"},{p:"16",up:"10",q:"10",d:"5"}],"4":[{p:"40",up:"10",q:"1",d:"5"},{p:"40",up:"10",q:"2",d:"5"},{p:"40",up:"10",q:"3",d:"5"},{p:"38",up:"10",q:"4",d:"5"},{p:"38",up:"10",q:"5",d:"5"},{p:"36",up:"10",q:"6",d:"5"},{p:"36",up:"10",q:"7",d:"5"},{p:"36",up:"10",q:"8",d:"5"},{p:"36",up:"10",q:"9",d:"5"},{p:"36",up:"10",q:"10",d:"5"}]}},{id:"3",country:["26","61","66","143","153"],price:{"1":[{p:"25",up:"20",q:"1",d:"5"},{p:"25",up:"20",q:"2",d:"5"},{p:"25",up:"20",q:"3",d:"5"},{p:"25",up:"20",q:"4",d:"5"},{p:"25",up:"20",q:"5",d:"5"},{p:"25",up:"20",q:"6",d:"5"},{p:"25",up:"20",q:"7",d:"5"},{p:"25",up:"20",q:"8",d:"5"},{p:"25",up:"20",q:"9",d:"5"},{p:"25",up:"20",q:"10",d:"5"}],"2":[{p:"35",up:"20",q:"1",d:"5"},{p:"35",up:"20",q:"2",d:"5"},{p:"35",up:"20",q:"3",d:"5"},{p:"35",up:"20",q:"4",d:"5"},{p:"35",up:"20",q:"5",d:"5"},{p:"35",up:"20",q:"6",d:"5"},{p:"35",up:"20",q:"7",d:"5"},{p:"35",up:"20",q:"8",d:"5"},{p:"35",up:"20",q:"9",d:"5"},{p:"35",up:"20",q:"10",d:"5"}],"3":[{p:"30",up:"20",q:"1",d:"5"},{p:"30",up:"20",q:"2",d:"5"},{p:"30",up:"20",q:"3",d:"5"},{p:"30",up:"20",q:"4",d:"5"},{p:"30",up:"20",q:"5",d:"5"},{p:"30",up:"20",q:"6",d:"5"},{p:"30",up:"20",q:"7",d:"5"},{p:"30",up:"20",q:"8",d:"5"},{p:"30",up:"20",q:"9",d:"5"},{p:"30",up:"20",q:"10",d:"5"}],"4":[{p:"50",up:"20",q:"1",d:"5"},{p:"50",up:"20",q:"2",d:"5"},{p:"50",up:"20",q:"3",d:"5"},{p:"50",up:"20",q:"4",d:"5"},{p:"50",up:"20",q:"5",d:"5"},{p:"50",up:"20",q:"6",d:"5"},{p:"50",up:"20",q:"7",d:"5"},{p:"50",up:"20",q:"8",d:"5"},{p:"50",up:"20",q:"9",d:"5"},{p:"50",up:"20",q:"10",d:"5"}]}}];function get_visa_rates(){var b=$("#visa_nationality").val();var d=$("#numb_visa").val();var j=$("#visa_type").val();var h=0;if($("#no_discount").length>0){h=1}var a=$("input:radio[name=rush_service]:checked").val();$("#selection_receive_date").html("");if(d!=0){getSelections(d);var k=get_visa_price(b,d,j,a);$("#visa_from_price").css("color","#B20000");$("#visa_from_price").css("font-size","12px");$("#visa_from_price").html(i18n.visa_calculating);$("#visa_total_fee").html("");$("#div_discount").css("display","none");var f=k.rate;var l=k.discount;$("#visa_from_price").css("font-size","14px");$("#visa_from_price").css("color","#333");if(l>0){$("#visa_discount").html("-$"+l);if(!isNaN(f)){f="$"+f}$("#visa_total_fee").html(f);$("#div_discount").css("display","block")}else{if(f!="NA"&&f!="Free"){f="$"+f}$("#visa_total_fee").html(f);$("#div_discount").css("display","none")}if(h==1){$("#visa_from_price").html("$"+k.price+" x "+d+"&nbsp;=&nbsp;");if($("#stemp_fee_table").length>0){var e=$("#stemp_fee_table").val();var c=e.split(",")[j-1];$("#stamp_fee").html("$"+c+" x "+d+"&nbsp;=&nbsp;");var g=parseInt(c)*parseInt(d);$("#stamp_total_fee").html("$"+g)}}else{$("#visa_from_price").html("$"+k.price+" x "+d)}if($("#selection_receive_date").length>0){$.ajax({url:"/vietnam_visa/get_receive_date/",type:"POST",cache:true,data:{rush_service:a},success:function(m){if(m!=""){$("#selection_receive_date").html(m)}}})}}else{clearSelections()}}function get_visa_price(e,d,b,f){var a=null;if(e==0){e=6}var c=0;$.each(RATE_TABLE,function(g,h){$.each(h.country,function(j,k){if(e==k){c=h.id}})});$.each(RATE_TABLE,function(g,h){if(h.id==c){$.each(h.price,function(j,k){if(b==j){$.each(k,function(m,n){if(d==n.q){var l=n;$price=0;if(l.p!=""){$total_fee=l.p*d;$price=l.p}else{$total_fee=0}if(f==2){$total_fee+=(l.up*d);$price=parseInt(l.p,10)+parseInt(l.up,10)}if($total_fee==0){if(l.p!=""){$total_fee="Free"}else{$total_fee="NA"}}a={rate:$total_fee,discount:0,price:$price}}})}})}});return a}function getSelections(c){$("#selection_nationality").css("color","#333");var a=c>1?c+" "+i18n.visa_applicants:c+" "+i18n.visa_applicant;var b="";if($("#visa_nationality option:selected").val()!="0"){b=" - "+$("#visa_nationality option:selected").text()}$("#selection_nationality").html(a+b);$("#selection_visa_type").html($("#visa_type option:selected").text());$("#selection_rush_service").html($("input:radio[name=rush_service]:checked").attr("title")+" "+i18n.visa_processing)}function clearSelections(){$("#selection_nationality").css("color","#B20000");$("#selection_nationality").html(i18n.visa_please_fill_form);$("#selection_visa_type").html("&nbsp;");$("#selection_rush_service").html("&nbsp;");$("#visa_from_price").html("");$("#visa_total_fee").html("");$("#div_discount").css("display","none")}function book_visa(a){var b=$("#visa_nationality").val();var c=$("#numb_visa").val();if(c!="0"&&b!="0"){window.frmApplyVisaDetail.action.value="book";window.frmApplyVisaDetail.submit()}else{if(typeof(a)!="undefined"){alert(i18n.visa_required_fields)}}}function change_visa_options(){if($("#update_visa_form").css("display")=="none"){$("#update_visa_form").css("display","block");$("#change_search").html(i18n.visa_hide_options+'<span class="icon icon-arrow-down"></span>')}else{$("#update_visa_form").css("display","none");$("#change_search").html(i18n.visa_change_options+'<span class="icon icon-arrow-down"></span>')}}function edit_visa_booking(){var a=$("#visa_nationality").val();var c=$("#numb_visa").val();var b=$("#crNumbVisa").val();if(a!="0"&&c!="0"){if(b>c&&!confirm(i18n.visa_confirm_change)){return false}window.frmVisaDetails.action.value="update";window.frmVisaDetails.submit()}}function submit_visa_details(f){if(validate_form()){var g=$("#arrival_day").val();var d=$("#arrival_month").val();var a=$("#arrival_year").val();if(g!=""&&d!=""&&a!=""){window.frmVisaDetails.arrival_date.value=g+"-"+d+"-"+a}var e=$("#exit_day").val();var c=$("#exit_month").val();var b=$("#exit_year").val();if(e!=""&&c!=""&&b!=""){window.frmVisaDetails.exit_date.value=e+"-"+c+"-"+b}$('select[name*="birth_day"]').each(function(){var l=$(this).attr("id");l=l.replace("birth_day","");var h=$(this).val();var k=$("#birth_month"+l).val();var j=$("#birth_year"+l).val();if(h!=""&&k!=""&&j!=""){$("#birthday"+l).val(h+"-"+k+"-"+j)}});$('select[name*="expired_day"]').each(function(){var l=$(this).attr("id");l=l.replace("expired_day","");var h=$(this).val();var k=$("#expired_month"+l).val();var j=$("#expired_year"+l).val();if(h!=""&&k!=""&&j!=""){$("#passport_expired"+l).val(h+"-"+k+"-"+j)}});$('input[name*="nationality_name"]').each(function(){var j=$(this).attr("id");j=j.replace("nationality_name","");var h=$("#nationality"+j+" option:selected").text();$(this).val(h)});window.frmVisaDetails.action.value=f;window.frmVisaDetails.submit()}}function skip_visa_details(){if(confirm(i18n.visa_visa_skip_steps)){window.location="/my-booking/"}}function check_requirements(){var a=$("#ck_nationality").val();if(a!=""){window.location="/vietnam-visa/visa-for-"+a}else{alert(i18n.visa_please_select_nationality)}}function init_visa_details(){$("#frmVisaDetails").find("input:visible:first").focus();$("#frmVisaDetails").data("serialize",$("#frmVisaDetails").serialize());window.onbeforeunload=function(){if($("#frmVisaDetails").serialize()!=$("#frmVisaDetails").data("serialize")&&window.frmVisaDetails.action.value==""){return i18n.visa_confirm_to_leave}};$(".app_nationality").change(function(){update_visa_price()});change_apply_type()}function change_apply_type(){var a=$("input[name=detail_type]:checked").val();if(a==2){$("#applicant_details").addClass("hide");$("#visa_email_note").removeClass("hide")}else{if(a==1){$("#applicant_details").removeClass("hide");$("#visa_email_note").addClass("hide");$("input[type='text']:first",document.forms[0]).focus()}}}function _check_applicant_details(d,c){var b=true;var a=["input[name='passport_name"+d+"']","select[name='gender"+d+"']","select[name='nationality"+d+"']","select[name='birth_day"+d+"']","select[name='birth_month"+d+"']","select[name='birth_year"+d+"']","input[name='passport_number"+d+"']"];a.forEach(function(k,g){var f=$("#edit_app_"+d+" "+k);if(f.val().length==0){$(f).addClass("red-border");b=false}else{$(f).removeClass("red-border");if(c=="update"){if(g==0||g==6){var j=$(f).parent().index();$("#app_"+d).find("td").eq(j).html(f.val())}else{if(g==1||g==2){var j=$(f).parent().index();var l=$(f).find(":selected").text();$("#app_"+d).find("td").eq(j).html(l)}else{if(g==3||g==4||g==5){var j=$(f).parent().index();var e=$("#birth_day"+d).val();var m=$("#birth_month"+d).val();var h=$("#birth_year"+d).val();if(e!=""&&m!=""&&h!=""){m=$("#birth_month"+d).find(":selected").text();m=m.substr(0,3);var l=e+" "+m+" "+h;$("#app_"+d).find("td").eq(j).html(l)}}}}}}});if(b==false){$("#dv_err").show()}return b}function validate_form(){if($("input[name=detail_type]").length){var b=$("input[name=detail_type]:checked").val();if(typeof b==="undefined"){$("#dv_err").show();return false}if(b==2){return true}}var a=true;$("#applicant_details tr").each(function(){var e=$(this);var c=$(e).attr("id").indexOf("edit_app");if(c==0){var d=$(e).attr("id").replace("edit_app_","");if(!_check_applicant_details(d,"")){a=false}}});return a}function update_visa_price(){var f=$("#numb_visa").val();if(f!=0){var h=$("#visa_nationality").val();var a=$("#visa_type").val();var g=$("input:radio[name=rush_service]:checked").val();var c=0;for(i=0;i<f;i++){var e=h;var b=i+1;if($("#nationality"+b).length&&$("#nationality"+b).val()!=""){e=$("#nationality"+b).val()}var d=get_visa_price(e,1,a,g);c=parseInt(c,10)+parseInt(d.rate,10)}if(!isNaN(c)){c="$"+c}$("#visa_total_fee").html(c);$("#visa_from_price").html(c)}};