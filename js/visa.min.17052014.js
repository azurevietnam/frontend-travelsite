var RATE_TABLE={"1":[{p:"12",up:"10",q:"1",d:"5"},{p:"12",up:"10",q:"2",d:"5"},{p:"12",up:"10",q:"3",d:"5"},{p:"12",up:"10",q:"4",d:"5"},{p:"12",up:"10",q:"5",d:"5"},{p:"12",up:"10",q:"6",d:"5"},{p:"12",up:"10",q:"7",d:"5"},{p:"12",up:"10",q:"8",d:"5"},{p:"12",up:"10",q:"9",d:"5"},{p:"12",up:"10",q:"10",d:"5"}],"2":[{p:"25",up:"10",q:"1",d:"5"},{p:"25",up:"10",q:"2",d:"5"},{p:"25",up:"10",q:"3",d:"5"},{p:"25",up:"10",q:"4",d:"5"},{p:"25",up:"10",q:"5",d:"5"},{p:"25",up:"10",q:"6",d:"5"},{p:"25",up:"10",q:"7",d:"5"},{p:"25",up:"10",q:"8",d:"5"},{p:"25",up:"10",q:"9",d:"5"},{p:"25",up:"10",q:"10",d:"5"}],"3":[{p:"20",up:"10",q:"1",d:"5"},{p:"20",up:"10",q:"2",d:"5"},{p:"20",up:"10",q:"3",d:"5"},{p:"18",up:"10",q:"4",d:"5"},{p:"18",up:"10",q:"5",d:"5"},{p:"16",up:"10",q:"6",d:"5"},{p:"16",up:"10",q:"7",d:"5"},{p:"16",up:"10",q:"8",d:"5"},{p:"16",up:"10",q:"9",d:"5"},{p:"16",up:"10",q:"10",d:"5"}],"4":[{p:"40",up:"10",q:"1",d:"5"},{p:"40",up:"10",q:"2",d:"5"},{p:"40",up:"10",q:"3",d:"5"},{p:"38",up:"10",q:"4",d:"5"},{p:"38",up:"10",q:"5",d:"5"},{p:"36",up:"10",q:"6",d:"5"},{p:"36",up:"10",q:"7",d:"5"},{p:"36",up:"10",q:"8",d:"5"},{p:"36",up:"10",q:"9",d:"5"},{p:"36",up:"10",q:"10",d:"5"}]};function get_visa_rates(){var b=$("#visa_nationality").val();var d=$("#numb_visa").val();var i=$("#visa_type").val();var h=0;if($("#no_discount").length>0){h=1}var a=$("input:radio[name=rush_service]:checked").val();$("#selection_receive_date").html("");if(d!=0){getSelections(d);var j=get_visa_price(b,d,i,a);$("#visa_from_price").css("color","#B20000");$("#visa_from_price").css("font-size","12px");$("#visa_from_price").html("Calculating ...");$("#visa_total_fee").html("");$("#div_discount").css("display","none");var f=j.rate;var k=j.discount;$("#visa_from_price").css("font-size","14px");$("#visa_from_price").css("color","#333");if(k>0){$("#visa_discount").html("-$"+k);if(!isNaN(f)){f="$"+f}$("#visa_total_fee").html(f);$("#div_discount").css("display","block")}else{if(f!="NA"&&f!="Free"){f="$"+f}$("#visa_total_fee").html(f);$("#div_discount").css("display","none")}if(h==1){$("#visa_from_price").html("$"+j.price+" x "+d+"&nbsp;=&nbsp;");if($("#stemp_fee_table").length>0){var e=$("#stemp_fee_table").val();var c=e.split(",")[i-1];$("#stamp_fee").html("$"+c+" x "+d+"&nbsp;=&nbsp;");var g=parseInt(c)*parseInt(d);$("#stamp_total_fee").html("$"+g)}}else{$("#visa_from_price").html("$"+j.price+" x "+d)}if($("#selection_receive_date").length>0){$.ajax({url:"/vietnam_visa/get_receive_date/",type:"POST",cache:true,data:{rush_service:a},success:function(l){if(l!=""){$("#selection_receive_date").html(l)}}})}}else{clearSelections()}}function get_visa_price(d,c,b,e){var a=null;$.each(RATE_TABLE,function(f,g){if(b==f){$.each(g,function(j,k){if(c==k.q){var h=k;$price=0;if(h.p!=""){$total_fee=h.p*c;$price=h.p}else{$total_fee=0}if(e==2){$total_fee+=(h.up*c);$price=parseInt(h.p,10)+parseInt(h.up,10)}if($total_fee==0){if(h.p!=""){$total_fee="Free"}else{$total_fee="NA"}}a={rate:$total_fee,discount:0,price:$price}}})}});return a}function getSelections(c){$("#selection_nationality").css("color","#333");var a=c>1?c+" applicants":c+" applicant";var b="";if($("#visa_nationality option:selected").val()!="0"){b=" - "+$("#visa_nationality option:selected").text()}$("#selection_nationality").html(a+b);$("#selection_visa_type").html($("#visa_type option:selected").text());$("#selection_rush_service").html($("input:radio[name=rush_service]:checked").attr("title")+" processing")}function clearSelections(){$("#selection_nationality").css("color","#B20000");$("#selection_nationality").html("Please fill the apply form");$("#selection_visa_type").html("&nbsp;");$("#selection_rush_service").html("&nbsp;");$("#visa_from_price").html("");$("#visa_total_fee").html("");$("#div_discount").css("display","none")}function book_visa(a){var b=$("#visa_nationality").val();var c=$("#numb_visa").val();if(c!="0"){window.frmApplyVisaDetail.action.value="book";window.frmApplyVisaDetail.submit()}else{if(typeof(a)!="undefined"){alert("Please select your nationality, number of visa, type of visa and processing time !!!")}}}function change_visa_options(){if($("#update_visa_form").css("display")=="none"){$("#update_visa_form").css("display","block");$("#change_search").html('Hide Visa Options<span class="icon icon-arrow-down"></span>')}else{$("#update_visa_form").css("display","none");$("#change_search").html('Change Visa Options<span class="icon icon-arrow-down"></span>')}}function edit_visa_booking(){var a=$("#visa_nationality").val();var c=$("#numb_visa").val();var b=$("#crNumbVisa").val();if(a!="0"&&c!="0"){if(b>c&&!confirm("Do you really want to change the number of visa?")){return false}window.frmVisaDetails.action.value="update";window.frmVisaDetails.submit()}}function submit_visa_details(f){if(validate_form()){var g=$("#arrival_day").val();var d=$("#arrival_month").val();var a=$("#arrival_year").val();if(g!=""&&d!=""&&a!=""){window.frmVisaDetails.arrival_date.value=g+"-"+d+"-"+a}var e=$("#exit_day").val();var c=$("#exit_month").val();var b=$("#exit_year").val();if(e!=""&&c!=""&&b!=""){window.frmVisaDetails.exit_date.value=e+"-"+c+"-"+b}$('select[name*="birth_day"]').each(function(){var k=$(this).attr("id");k=k.replace("birth_day","");var h=$(this).val();var j=$("#birth_month"+k).val();var i=$("#birth_year"+k).val();if(h!=""&&j!=""&&i!=""){$("#birthday"+k).val(h+"-"+j+"-"+i)}});$('select[name*="expired_day"]').each(function(){var k=$(this).attr("id");k=k.replace("expired_day","");var h=$(this).val();var j=$("#expired_month"+k).val();var i=$("#expired_year"+k).val();if(h!=""&&j!=""&&i!=""){$("#passport_expired"+k).val(h+"-"+j+"-"+i)}});$('input[name*="nationality_name"]').each(function(){var i=$(this).attr("id");i=i.replace("nationality_name","");var h=$("#nationality"+i+" option:selected").text();$(this).val(h)});window.frmVisaDetails.action.value=f;window.frmVisaDetails.submit()}}function skip_visa_details(){if(confirm("Do you really want skip this step and provide visa details later?")){window.location="/my-booking/"}}function check_requirements(){var a=$("#ck_nationality").val();if(a!=""){window.location="/vietnam-visa/visa-for-"+a}else{alert("Please select your nationality !!!")}}function init_visa_details(){$("#frmVisaDetails").find("input:visible:first").focus();$("#frmVisaDetails").data("serialize",$("#frmVisaDetails").serialize());window.onbeforeunload=function(){if($("#frmVisaDetails").serialize()!=$("#frmVisaDetails").data("serialize")&&window.frmVisaDetails.action.value==""){return"Are you sure you want to leave this page?"}};change_apply_type()}function change_apply_type(){var a=$("input[name=detail_type]:checked").val();if(a==2){$("#applicant_details").addClass("hide");$("#visa_email_note").removeClass("hide")}else{if(a==1){$("#applicant_details").removeClass("hide");$("#visa_email_note").addClass("hide");$("input[type='text']:first",document.forms[0]).focus()}}}function _check_applicant_details(d,c){var b=true;var a=["input[name='passport_name"+d+"']","select[name='gender"+d+"']","select[name='nationality"+d+"']","select[name='birth_day"+d+"']","select[name='birth_month"+d+"']","select[name='birth_year"+d+"']","input[name='passport_number"+d+"']"];a.forEach(function(j,g){var f=$("#edit_app_"+d+" "+j);if(f.val().length==0){$(f).addClass("red-border");b=false}else{$(f).removeClass("red-border");if(c=="update"){if(g==0||g==6){var i=$(f).parent().index();$("#app_"+d).find("td").eq(i).html(f.val())}else{if(g==1||g==2){var i=$(f).parent().index();var k=$(f).find(":selected").text();$("#app_"+d).find("td").eq(i).html(k)}else{if(g==3||g==4||g==5){var i=$(f).parent().index();var e=$("#birth_day"+d).val();var l=$("#birth_month"+d).val();var h=$("#birth_year"+d).val();if(e!=""&&l!=""&&h!=""){l=$("#birth_month"+d).find(":selected").text();l=l.substr(0,3);var k=e+" "+l+" "+h;$("#app_"+d).find("td").eq(i).html(k)}}}}}}});if(b==false){$("#dv_err").show()}return b}function validate_form(){if($("input[name=detail_type]").length){var b=$("input[name=detail_type]:checked").val();if(typeof b==="undefined"){$("#dv_err").show();return false}if(b==2){return true}}var a=true;$("#applicant_details tr").each(function(){var e=$(this);var c=$(e).attr("id").indexOf("edit_app");if(c==0){var d=$(e).attr("id").replace("edit_app_","");if(!_check_applicant_details(d,"")){a=false}}});return a};